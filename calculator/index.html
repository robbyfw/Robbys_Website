<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scientific Calculator â€” Muhammad Asim (Robby)</title>

<!-- Website Logo / Favicon -->
<link rel="icon" type="image/png" href="/Studio-Project.png">
<link rel="apple-touch-icon" href="/Studio-Project.png">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* ===== Reset & base ===== */
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Poppins',sans-serif;
  background: linear-gradient(270deg,#1c1c1c,#2a2a2a,#1c1c1c);
  background-size:600% 600%;
  animation:waterflow 20s ease infinite;
  -webkit-animation:waterflow 20s ease infinite;
  background-attachment: fixed;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:32px;
}

/* mobile fix for fixed background */
@media (max-width:768px){ body{ background-attachment:scroll; padding:16px } }

@keyframes waterflow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* app layout */
.container{
  width:100%;
  max-width:780px;
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:center;
}

/* card */
.card{
  width:100%;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:16px;
  padding:18px;
  box-shadow:0 12px 30px rgba(0,0,0,0.6);
  backdrop-filter: blur(12px);
}

/* header / display */
.topbar{ display:flex; gap:12px; align-items:center; margin-bottom:12px; }
.mode{ margin-left:auto; display:flex; gap:8px; align-items:center; color:#cfd8ff; font-size:0.95rem; }
.expr{ color:#bfc6d6; font-size:0.9rem; opacity:0.95; text-align:right; margin-bottom:6px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.display{
  background: rgba(0,0,0,0.36);
  padding:12px 14px;
  border-radius:10px;
  min-height:64px;
  font-size:1.8rem;
  text-align:right;
  overflow-x:auto;
  white-space:nowrap;
}

/* grid layout - groups visually separated */
.grid{
  display:grid;
  gap:10px;
  grid-template-columns: repeat(8, 1fr);
}

/* button base */
.btn{
  border: none;
  padding:12px;
  border-radius:10px;
  background: rgba(255,255,255,0.06);
  color: #fff;
  font-size:1rem;
  cursor:pointer;
  box-shadow: 0 6px 12px rgba(0,0,0,0.45);
  transition: transform .12s ease, background .12s ease;
}
.btn:active{ transform: translateY(2px) }
.btn:hover{ background: rgba(0,120,255,0.14) }

/* variants */
.op{ background: linear-gradient(180deg, rgba(0,120,255,0.82), rgba(0,96,200,0.82)); color:#fff }
.func{ background: rgba(200,200,255,0.06); color: #eaf2ff }
.eq { background: linear-gradient(180deg,#00ffab,#00e594); color:#000; grid-column: span 2 }
.clear{ background: linear-gradient(180deg,#ff6b6b,#ff4b4b); color:#fff }
.wide2 { grid-column: span 2 }
.wide3 { grid-column: span 3 }

/* responsive adjustments */
@media (max-width:980px){
  .grid{ grid-template-columns: repeat(6, 1fr); }
  .expr{ font-size:0.85rem }
  .display{ font-size:1.4rem; min-height:56px }
}
@media (max-width:520px){
  .grid{ grid-template-columns: repeat(4, 1fr); gap:8px; }
  .eq{ grid-column: span 2 }
  .display{ font-size:1.2rem; min-height:50px }
}

/* footer narrow line */
.footer{
  width:100%;
  max-width:720px;
  text-align:center;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,0.14);
  color:#ccc;
  font-size:0.95rem;
  margin-top:8px;
  border-radius:6px;
}
</style>
</head>
<body>
  <div class="container">
    <div class="card" role="application" aria-label="Scientific calculator">
      <div class="topbar">
        <div style="flex:1">
          <div class="expr" id="expr">&nbsp;</div>
          <div class="display" id="display">0</div>
        </div>
        <div class="mode">
          <label style="display:flex;gap:8px;align-items:center;cursor:pointer">
            <input id="degToggle" type="checkbox" style="transform:scale(1.05)" />
            <span id="degLabel">RAD</span>
          </label>
        </div>
      </div>

      <!-- buttons -->
      <div class="grid" id="grid">
        <!-- row 1 -->
        <button class="btn clear" data-action="clear">C</button>
        <button class="btn func" data-action="back">âŒ«</button>
        <button class="btn func" data-action="(">(</button>
        <button class="btn func" data-action=")">)</button>
        <button class="btn func" data-action="pi">Ï€</button>
        <button class="btn func" data-action="e">e</button>
        <button class="btn func" data-action="root">nâˆš</button>
        <button class="btn op" data-value="Ã·">Ã·</button>

        <!-- row 2 -->
        <button class="btn" data-value="7">7</button>
        <button class="btn" data-value="8">8</button>
        <button class="btn" data-value="9">9</button>
        <button class="btn op" data-value="Ã—">Ã—</button>
        <button class="btn func" data-action="sqrt">âˆš</button>
        <button class="btn func" data-action="cuberoot">âˆ›</button>
        <button class="btn func" data-action="pow2">xÂ²</button>
        <button class="btn func" data-action="pow3">xÂ³</button>

        <!-- row 3 -->
        <button class="btn" data-value="4">4</button>
        <button class="btn" data-value="5">5</button>
        <button class="btn" data-value="6">6</button>
        <button class="btn op" data-value="-">âˆ’</button>
        <button class="btn func" data-action="sin">sin</button>
        <button class="btn func" data-action="cos">cos</button>
        <button class="btn func" data-action="tan">tan</button>
        <button class="btn func" data-action="fact">n!</button>

        <!-- row 4 -->
        <button class="btn" data-value="1">1</button>
        <button class="btn" data-value="2">2</button>
        <button class="btn" data-value="3">3</button>
        <button class="btn op" data-value="+">+</button>
        <button class="btn func" data-action="ln">ln</button>
        <button class="btn func" data-action="log">log</button>
        <button class="btn func" data-action="exp">eË£</button>
        <button class="btn func" data-action="percent">%</button>

        <!-- row 5 -->
        <button class="btn wide2" data-value="0">0</button>
        <button class="btn" data-value=".">.</button>
        <button class="btn func" data-action="plusminus">Â±</button>
        <button class="btn eq" data-action="equals">=</button>
        <button class="btn func" data-action="ans">Ans</button>
        <button class="btn func" data-action="ce">CE</button>
      </div>
    </div>

    <div class="footer">Â© 2025 Muhammad Asim (Robby) â€¢ Built with ðŸ–¤</div>
  </div>

<script>
/* --- Core state & elements --- */
const displayEl = document.getElementById('display');
const exprEl = document.getElementById('expr');
const grid = document.getElementById('grid');
const degToggle = document.getElementById('degToggle');
const degLabel = document.getElementById('degLabel');

let expression = '';
let lastAnswer = null;

degToggle.addEventListener('change', ()=>{ degLabel.textContent = degToggle.checked ? 'DEG' : 'RAD'; });
degLabel.textContent = degToggle.checked ? 'DEG' : 'RAD';

/* --- Utility: detect last token (number or parenthesized expression) --- */
function getLastTokenRange(expr) {
  if (!expr) return null;
  let i = expr.length - 1;

  // skip trailing whitespace (if any)
  while (i >= 0 && expr[i] === ' ') i--;

  if (i < 0) return null;

  // if ends with ')', find matching '('
  if (expr[i] === ')') {
    let depth = 0;
    for (let j = i; j >= 0; j--) {
      if (expr[j] === ')') depth++;
      else if (expr[j] === '(') {
        depth--;
        if (depth === 0) {
          return [j, i + 1]; // start idx inclusive, end exclusive
        }
      }
    }
    return null; // unbalanced
  }

  // else, find contiguous number characters (digits and dot)
  let start = i;
  while (start >= 0 && /[0-9.]/.test(expr[start])) start--;
  start++;
  if (start <= i) return [start, i + 1];

  return null;
}

/* Replace last token with new text */
function replaceLastToken(newText) {
  const r = getLastTokenRange(expression);
  if (!r) {
    expression += newText;
  } else {
    expression = expression.slice(0, r[0]) + newText + expression.slice(r[1]);
  }
  refresh();
}

/* Append token safely */
function appendToken(tok) {
  // prevent multiple consecutive operators (except minus for sign)
  const last = expression.slice(-1);
  if (/^[+\-Ã—Ã·*/^]$/.test(last) && /^[+\-Ã—Ã·*/^]$/.test(tok)) {
    // replace last operator with new
    expression = expression.slice(0, -1) + tok;
  } else {
    expression += tok;
  }
  refresh();
}

/* Refresh UI */
function refresh(){
  exprEl.textContent = expression || '\u00A0';
  displayEl.textContent = expression === '' ? '0' : expression;
}

/* --- Button handling --- */
grid.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('button');
  if (!btn) return;
  const value = btn.dataset.value;
  const action = btn.dataset.action;
  if (value !== undefined) {
    // numeric or operator token
    handleValue(value);
  } else if (action) {
    handleAction(action);
  }
});

/* Value input (digits, ., operator symbols like Ã— Ã· + - ) */
function handleValue(v) {
  // dot rules: don't allow second dot in same number
  if (v === '.') {
    const r = getLastTokenRange(expression);
    if (r) {
      const part = expression.slice(r[0], r[1]);
      if (part.includes('.')) return;
    }
  }
  // append numeric or operator tokens
  appendToken(v);
}

/* Main action handler */
function handleAction(act) {
  switch(act) {
    case 'clear':
      expression = '';
      refresh();
      break;
    case 'ce':
      { // clear last token
        const r = getLastTokenRange(expression);
        if (r) expression = expression.slice(0, r[0]);
        else expression = '';
        refresh();
      }
      break;
    case 'back':
      expression = expression.slice(0,-1);
      refresh();
      break;
    case '(':
    case ')':
      appendToken(act);
      break;
    case 'sqrt':
      applySqrtToLastToken();
      break;
    case 'cuberoot':
      applyNthRootToLastToken(3);
      break;
    case 'root':
      // append root( , user can type root(n, x) or use later editing
      // but we also provide helper: if last token exists, wrap as root(?, token)
      {
        const r = getLastTokenRange(expression);
        if (r) {
          // if user wants nâˆšx, we will wrap existing last token as root(2, token) placeholder
          const token = expression.slice(r[0], r[1]);
          expression = expression.slice(0, r[0]) + `root( ,${token})`;
          // place caret for editing is not possible, but user can replace the blank with degree number
        } else {
          expression += 'root(';
        }
        refresh();
      }
      break;
    case 'pow2':
      wrapLastTokenWithSuffix('^2');
      break;
    case 'pow3':
      wrapLastTokenWithSuffix('^3');
      break;
    case 'sin':
    case 'cos':
    case 'tan':
    case 'ln':
    case 'log':
      appendToken(act + '(');
      break;
    case 'exp':
      appendToken('exp(');
      break;
    case 'pi':
      appendToken('Ï€');
      break;
    case 'e':
      appendToken('e');
      break;
    case 'percent':
    case '%':
      // if last token is number or paren, add %
      {
        const r = getLastTokenRange(expression);
        if (r) {
          expression = expression.slice(0, r[1]) + '%';
        } else {
          expression += '%';
        }
        refresh();
      }
      break;
    case 'fact':
      applyFactorialToLast();
      break;
    case 'plusminus':
      toggleSignOfLast();
      break;
    case 'equals':
      evaluate();
      break;
    case 'ans':
      if (lastAnswer !== null) expression += lastAnswer;
      refresh();
      break;
    case 'backspace':
      expression = expression.slice(0,-1);
      refresh();
      break;
    default:
      console.warn('unknown action', act);
  }
}

/* ---------- token-based helpers ---------- */

function applySqrtToLastToken(){
  const r = getLastTokenRange(expression);
  if (r) {
    const token = expression.slice(r[0], r[1]);
    expression = expression.slice(0, r[0]) + `sqrt(${token})`;
  } else {
    // no token -> append sqrt(
    expression += 'sqrt(';
  }
  refresh();
}

function applyNthRootToLastToken(n){
  const r = getLastTokenRange(expression);
  if (r) {
    const token = expression.slice(r[0], r[1]);
    // replace token with (token)^(1/n)
    expression = expression.slice(0, r[0]) + `(${token})^(1/${n})`;
  } else {
    // append nth root wrapper
    expression += `^(1/${n})`;
  }
  refresh();
}

function wrapLastTokenWithSuffix(suffix) {
  const r = getLastTokenRange(expression);
  if (r) {
    const token = expression.slice(r[0], r[1]);
    expression = expression.slice(0, r[0]) + `(${token})${suffix}`;
  } else {
    expression += suffix;
  }
  refresh();
}

function applyFactorialToLast(){
  const r = getLastTokenRange(expression);
  if (!r) return;
  const token = expression.slice(r[0], r[1]);
  const n = Number(token);
  if (!Number.isFinite(n) || n < 0 || !Number.isInteger(n)) {
    alert('Factorial requires a non-negative integer');
    return;
  }
  // compute and replace
  let res = 1;
  for (let i=2;i<=n;i++) res *= i;
  expression = expression.slice(0, r[0]) + String(res);
  refresh();
}

function toggleSignOfLast(){
  const r = getLastTokenRange(expression);
  if (!r) {
    expression = '-';
    refresh();
    return;
  }
  let tok = expression.slice(r[0], r[1]);
  if (tok.startsWith('-')) {
    tok = tok.slice(1);
  } else {
    tok = '-' + tok;
  }
  expression = expression.slice(0, r[0]) + tok + expression.slice(r[1]);
  refresh();
}

/* ---------- evaluation ---------- */

function evaluate(){
  if (!expression) {
    displayEl.textContent = '0';
    return;
  }
  if (!balancedParens(expression)) {
    displayEl.textContent = 'Error: parentheses';
    return;
  }

  // transform to JS code
  let code = expression.slice();

  // replace visual operators and constants
  code = code.replace(/Ã—/g, '*').replace(/Ã·/g, '/').replace(/Ï€/g, 'pi');

  // replace percentages: "50%" -> (50/100)
  code = code.replace(/([0-9.]+)%/g, '($1/100)');
  code = code.replace(/\)%/g, ')/100');

  // ^ -> **
  code = code.replace(/\^/g, '**');

  // leave function tokens: sin( cos( tan( sqrt( log( ln( exp( root(
  // we'll supply those in the function scope

  // sanitize: remove any characters that are obviously invalid (this is a basic check)
  if (/[^0-9+\-*/%^().,eÏ€Ã—Ã·\sA-Za-z_]/.test(code)) {
    displayEl.textContent = 'Error';
    return;
  }

  try {
    const degreeMode = degToggle.checked; // DEG if checked

    const sin = x => degreeMode ? Math.sin(x * Math.PI / 180) : Math.sin(x);
    const cos = x => degreeMode ? Math.cos(x * Math.PI / 180) : Math.cos(x);
    const tan = x => degreeMode ? Math.tan(x * Math.PI / 180) : Math.tan(x);
    const sqrt = x => Math.sqrt(x);
    const ln = x => Math.log(x);
    const log = x => Math.log10 ? Math.log10(x) : Math.log(x)/Math.LN10;
    const exp = x => Math.exp(x);
    const pi = Math.PI;
    const e = Math.E;

    const root = (n, x) => {
      n = Number(n); x = Number(x);
      if (!Number.isFinite(n) || !Number.isFinite(x) || n === 0) throw new Error('Invalid root');
      // handle negative radicand with odd n
      if (x < 0 && Math.abs(n % 2) === 1) return -Math.pow(Math.abs(x), 1/n);
      return Math.pow(x, 1/n);
    };

    // Create a safe Function with these helpers
    const fn = new Function(
      'sin','cos','tan','sqrt','ln','log','exp','pi','e','root',
      'return (' + code + ')'
    );

    let result = fn(sin, cos, tan, sqrt, ln, log, exp, pi, e, root);

    if (!Number.isFinite(result)) {
      displayEl.textContent = 'Error';
      return;
    }
    // format result: avoid too many decimals
    if (Math.abs(result) < 1e-12) result = 0;
    const rStr = Number(Math.round(result * 1e12) / 1e12).toString();
    displayEl.textContent = rStr;
    exprEl.textContent = expression + ' =';
    lastAnswer = rStr;
    expression = String(rStr); // allow chaining
  } catch (err) {
    console.error(err);
    displayEl.textContent = 'Error';
  }
}

/* balanced parentheses check */
function balancedParens(s){
  let c = 0;
  for (let ch of s) {
    if (ch === '(') c++;
    else if (ch === ')') {
      c--;
      if (c < 0) return false;
    }
  }
  return c === 0;
}

/* initial UI */
refresh();

</script>
</body>
</html>
